import React, {useState} from "react";
import {MatchProvider} from "@matchain/mid";
import {BrowserRouter as Router, Routes, Route, Link} from 'react-router-dom';
import Home from "./pages/Home";
import './app.css'
import Login from "./pages/Login";
import "@matchain/mid/index.css"

const getState = () => {
    if (window.localStorage.getItem('match-local')) {
        const state = JSON.parse(window.localStorage.getItem('match-local') as string)
        return state.state
    }
    return null
}

function App() {
    const state = getState()
    const [appid, setAppid] = useState(state?.appid || '')
    const [env, setEnv] = useState<"main" | "dev" | "test">(state?.env || 'main')
    //matchain team will debug in dev env
    const isMatchainTeam = !!window.localStorage.getItem("isMatchainTeam")
    return <MatchProvider appid={appid} env={env}  events={{
        onLogin: (data) => {
            console.log('events.onLogin', data)
        },
        onLogout: () => {
            console.log('events.onLogout')
        }
    }}
    >
        <Router>
            <div className={`mb-2 p-2 flex gap-2`}>
                <label>Appid:</label>
                <input value={appid} placeholder={"Appid"} className={"border-solid border"} onChange={(ele) => {
                    setAppid(ele.target.value)
                }}/>
                <label>Env:</label>
                <select value={env} onChange={(ele) => {
                    setEnv(ele.target.value as any)
                }}>
                    <option value="main">main</option>
                    <option value="test">test</option>
                    {isMatchainTeam && <option value="dev">dev</option>}
                </select>
            </div>
            <nav className={`text-2xl mb-5 p-2 text-red-600 flex gap-10`}>
                <Link to="/">Home</Link>
                <Link to="/login">Login</Link>
            </nav>
            <div className={`p-4`}>
                <Routes>
                    <Route path="/" element={<Home/>}/>
                    <Route path="/login" element={<Login/>}/>
                </Routes>
            </div>
        </Router>
    </MatchProvider>;
}

export default App;

import {Hooks, Components} from "@matchain/mid"
import React from "react";

const {useMatchEvents, useUserInfo, useWallet} = Hooks
const {LoginButton, LoginBox, LoginPanel, EmailModal, LoginModal, UsernameModal, PasswordModal} = Components


function LoginContent() {
    useMatchEvents({
        onLogin: (data) => {
            console.log('useMatchEvents.onLogin', data)
        },
        onLogout: () => {
            console.log('useMatchEvents.onLogout')
        },
        onBind: (data) => {
            console.log('useMatchEvents.onBind', data)
        }
    })
    const {
        loginByWallet,
        isLogin,
        token,
        logout,
        username,
        loginByTwitter,
        loginByGoogle,
        loginByEmail,
        getLoginEmailCode,
        loginByTelegram,
        refreshOverview,
        did,
        address,
        bindWallet,
        bindTelegram,
    } = useUserInfo();
    const {signMessage} = useWallet()
    const [email, setEmail] = React.useState('')
    const [code, setCode] = React.useState('')
    const [emailOpen, setEmailOpen] = React.useState(false)
    const [loginOpen, setLoginOpen] = React.useState(false)
    const [usernameOpen, setUsernameOpen] = React.useState(false)
    const [passwordOpen, setPasswordOpen] = React.useState(false)
    const refreshOv = async () => {
        await refreshOverview()
        alert('refreshed')
    }
    const onSign = async () => {
        const res = await signMessage('hello')
        alert(res)
    }
    if (isLogin) {
        return <div>
            <h1 className={`text-2xl`}>You are already logged in</h1>
            <div className={`text-ellipsis break-words`}>token:{token}</div>
            <div className={`text-ellipsis break-words`}>username:{username}</div>
            <div className={`text-ellipsis break-words`}>did:{did}</div>
            <div className={`text-ellipsis break-words`}>address:{address}</div>
            <div className={`flex gap-[20px]`}>
                <button className={`bg-gray-300 p-1 rounded mr-5`}
                        onClick={bindWallet}>Bind wallet
                </button>
                <button className={`bg-gray-300 p-1 rounded mr-5`}
                        onClick={() => setUsernameOpen(true)}>Set username
                </button>
                <UsernameModal isOpen={usernameOpen} onClose={() => setUsernameOpen(false)} onBack={() => {
                    console.log('set username modal back event')
                    setUsernameOpen(false)
                }} onSuccess={() => {
                    alert('set username success')
                    setUsernameOpen(false)
                }}/>
                <button className={`bg-gray-300 p-1 rounded mr-5`}
                        onClick={() => setPasswordOpen(true)}>Set Password
                </button>
                <PasswordModal isOpen={passwordOpen} onClose={() => setPasswordOpen(false)} onBack={() => {
                    console.log('set password modal back event')
                    setPasswordOpen(false)
                }} onSuccess={() => {
                    alert('set password success')
                    setPasswordOpen(false)
                }}/>
                <button className={`bg-gray-300 p-1 rounded mr-5`}
                        onClick={bindTelegram}>Bind telegram
                </button>
                <button className={`bg-gray-300 p-1 rounded`}
                        onClick={onSign}>Sign message
                </button>
            </div>
            <button className={`bg-gray-300 p-1 rounded mr-5`}
                    onClick={refreshOv}>Refresh Overview
            </button>
            <button className={`bg-gray-300 p-1 rounded`}
                    onClick={logout}>Logout
            </button>

        </div>
    }
    return (
        <div className={`flex flex-col gap-10`}>
            <div className={`flex gap-5`}>
                <button className={`bg-gray-300 p-1 rounded`}
                        onClick={loginByWallet}>Wallet
                </button>
                <button className={`bg-gray-300 p-1 rounded`}
                        onClick={loginByTwitter}>Twitter
                </button>
                <button className={`bg-gray-300 p-1 rounded`}
                        onClick={loginByGoogle}>Google
                </button>
                <button className={`bg-gray-300 p-1 rounded`}
                        onClick={loginByTelegram}>Telegram
                </button>
                <button className={`bg-gray-300 p-1 rounded`}
                        onClick={() => setEmailOpen(true)}>Email
                </button>
                <EmailModal isOpen={emailOpen} onClose={() => setEmailOpen(false)} onBack={() => {
                    console.log('input email modal back event')
                    setEmailOpen(false)
                }}/>

                <button className={`bg-gray-300 p-1 rounded`}
                        onClick={() => setLoginOpen(true)}>Modal
                </button>
                <LoginModal isOpen={loginOpen} onClose={() => setLoginOpen(false)}/>

            </div>
            <div className={`flex gap-5`}>
                <input type={"text"} className={`border`} placeholder={"email"}
                       onChange={(e) => setEmail(e.target.value)} value={email}/>
                <button className={`bg-gray-300 p-1 rounded`}
                        onClick={() => getLoginEmailCode(email)}>Send
                </button>
            </div>
            <div className={`flex gap-5`}>
                <input type={"text"} className={`border`} placeholder={"code"}
                       onChange={(e) => setCode(e.target.value)} value={code}/>
                <button className={`bg-gray-300 p-1 rounded`}
                        onClick={() => loginByEmail({email, code})}>Login
                </button>
            </div>
            <div className={`font-bold text-xl`}>Components</div>
            <div className={`font-bold text-lg`}>LoginBox</div>
            <div className={`bg-gray-100 p-10`}>
                <div className={`bg-white`}><LoginBox/></div>
            </div>
            <div className={`font-bold text-lg`}>LoginPanel</div>
            <div className={`bg-gray-100 p-10`}>
                <div className={`bg-white`}><LoginPanel onClose={() => console.log('onLoginPanelClose')}/></div>
            </div>
        </div>
    );
}

export default function Login() {
    return <div>
        <LoginContent/>
        <div className={`font-bold text-lg`}>LoginButton</div>

        <div className={`bg-gray-100 p-5 mt-5`}>
            <LoginButton methods={["wallet", "X", "email", "google"]}/>
        </div>

    </div>
}